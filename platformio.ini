; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/en/latest/projectconf/index.html

; Global PlatformIO settings
[platformio]
description = Controllino-based Irrigation Controller with MQTT and Home Assistant integration
default_envs = controllino_maxi

; Common settings shared across environments
[common]
; Common build flags
build_flags = 
    -DMQTT_MAX_PACKET_SIZE=768
    -Wall                           ; Enable all warnings
    -Wextra                         ; Enable extra warnings
    
; Common library dependencies
lib_deps = 
    knolleary/PubSubClient@^2.8     ; MQTT client library for Arduino
    bblanchon/ArduinoJson@^6.21.3   ; JSON library for parsing and serialization
    SPI                             ; SPI communication library
    arduino-libraries/Ethernet@^2.0.2 ; Ethernet library for network communication
    CONTROLLINO-PLC/CONTROLLINO@^3.0.7 ; Library for Controllino boards
    arduino-libraries/NTPClient@^3.2.1 ; Library for NTP time synchronization

; Monitor settings
monitor_speed = 115200
monitor_filters = 
    default                         ; Remove typical terminal control codes
    time                            ; Add timestamp to each line

; Main production environment
[env:controllino_maxi]
platform = atmelavr
board = controllino_maxi
framework = arduino

; Select which controller configuration to build:
; 1 = Front Garden, 2 = Back Garden
build_flags = 
    ${common.build_flags}
    -DIRRIGATION_CONTROLLER=2       ; Default: Back Garden (override with CLI)

; Inherit common dependencies
lib_deps = ${common.lib_deps}

; Monitor settings
monitor_speed = ${common.monitor_speed}
monitor_filters = ${common.monitor_filters}

; Upload settings
upload_protocol = wiring
upload_speed = 115200

; Environment for Front Garden controller
[env:front_garden]
platform = atmelavr
board = controllino_maxi
framework = arduino

build_flags = 
    ${common.build_flags}
    -DIRRIGATION_CONTROLLER=1       ; Front Garden configuration

lib_deps = ${common.lib_deps}
monitor_speed = ${common.monitor_speed}
monitor_filters = ${common.monitor_filters}
upload_protocol = wiring
upload_speed = 115200

; Environment for Back Garden controller
[env:back_garden]
platform = atmelavr
board = controllino_maxi
framework = arduino

build_flags = 
    ${common.build_flags}
    -DIRRIGATION_CONTROLLER=2       ; Back Garden configuration

lib_deps = ${common.lib_deps}
monitor_speed = ${common.monitor_speed}
monitor_filters = ${common.monitor_filters}
upload_protocol = wiring
upload_speed = 115200

